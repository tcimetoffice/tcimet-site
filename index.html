<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meteorology Department - Turks and Caicos Islands Airports Authority</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f2f2f2;
    }
    header {
      background: #0077b6;
      color: white;
      padding: 20px;
      text-align: center;
    }
    nav {
      background: #023e8a;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
    }
    nav a {
      color: white;
      padding: 15px 20px;
      text-decoration: none;
      display: block;
    }
    nav a:hover {
      background: #0077b6;
    }
    section {
      padding: 20px;
      max-width: 1000px;
      margin: auto;
      background: white;
      margin-top: 10px;
      border-radius: 8px;
    }
    iframe {
      width: 100%;
      height: 600px;
      border: none;
    }
    footer {
      background: #023e8a;
      color: white;
      text-align: center;
      padding: 20px 10px;
      margin-top: 20px;
    }
    .social-icons {
      margin-top: 10px;
    }
    .social-icons a {
      margin: 0 10px;
      display: inline-block;
    }
    .social-icons img {
      height: 32px;
      width: 32px;
      vertical-align: middle;
    }

  .alert-links {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-top: 1rem;
}

.alert-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  background: #f5f5f5;
  border-left: 6px solid #0077b6;
  padding: 1rem;
  border-radius: 8px;
  text-decoration: none;
  color: #000;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  flex: 1 1 200px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  position: relative;
}

.alert-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.alert-card .flag {
  font-size: 2rem;
}

.alert-card .label {
  font-weight: bold;
  margin-top: 0.5rem;
  font-size: 1rem;
}

.alert-card .lang {
  font-size: 0.9rem;
  color: #555;
  margin-top: 0.25rem;
}

.alert-card .alert-summary {
  margin-top: 0.75rem;
  font-size: 0.9rem;
  color: #222;
  max-height: 4.5em; /* approx 3 lines */
  overflow: hidden;
  text-overflow: ellipsis;
  padding: 0 5px;
  width: 100%;
}



/* Border colors for each language */
.alert-card.en { border-color: #0077b6; }
.alert-card.es { border-color: #f4a261; }
.alert-card.ht { border-color: #e63946; }

/* Pulse animation when alert active */
@keyframes pulseRedGlow {
  0% {
    box-shadow: 0 0 0 0 rgba(230, 57, 70, 0.7);
  }
  70% {
    box-shadow: 0 0 10px 10px rgba(230, 57, 70, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(230, 57, 70, 0);
  }
}

.alert-card.active {
  animation: pulseRedGlow 2s infinite;
}
  </style>
</head>
<body>

  <header style="background: #0077b6; color: white; padding: 20px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap;">
  <!-- Left side: Logo and Title -->
  <div style="display: flex; align-items: center; gap: 15px;">
    <img src="assets/tciaa-logo.png" alt="TCIAA Logo" style="height: 60px;" />
    <div>
      <h1 style="margin: 0;">Meteorology Department</h1>
      <p style="margin: 0;">Turks and Caicos Islands Airports Authority</p>
    </div>
  </div>
  
    <!-- Social Media Follow Section aligned right -->
    <div style="display: flex; align-items: center; gap: 12px; font-weight: bold; white-space: nowrap;">
      <span>Follow Us on Social Media:</span>
      <a href="https://www.facebook.com" target="_blank" aria-label="Facebook" style="color: white;">
        <img src="https://cdn-icons-png.flaticon.com/512/124/124010.png" alt="Facebook logo" style="height:24px; width:24px;">
      </a>
      <a href="https://www.twitter.com" target="_blank" aria-label="Twitter" style="color: white;">
        <img src="https://cdn-icons-png.flaticon.com/512/733/733579.png" alt="Twitter logo" style="height:24px; width:24px;">
      </a>
      <a href="https://www.instagram.com" target="_blank" aria-label="Instagram" style="color: white;">
        <img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram logo" style="height:24px; width:24px;">
      </a>
      <a href="https://www.youtube.com/@TCINationalWeatherService" target="_blank" aria-label="YouTube" style="color: white;">
        <img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="YouTube logo" style="height:24px; width:24px;">
      </a>
      <a href="https://whatsapp.com/channel/0029VaIwxeqJZg4BmM48Cx2r" target="_blank" aria-label="WhatsApp Broadcast Channel" style="color: white;">
        <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="WhatsApp logo" style="height:24px; width:24px;">
      </a>
    </div>
  </header>

  <nav>
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="current-weather.html">Current Weather</a>
    <a href="aviation.html">Aviation</a>
    <a href="forecast.html">Forecasts</a>
    <a href="tropical-weather.html">Tropical Weather</a>
    <a href="contact.html">Contact</a>
    <a href="external-links.html">External Links</a>
  </nav>

 <div class="cap-ticker">
    <div id="capAlertCrawl">🚨 Loading latest alert from TCI Emergency Alerts...</div>
  </div>

<style>
.cap-ticker {
  overflow: hidden;
  white-space: nowrap;
  background: #d90429;
  color: white;
  padding: 10px 0;
  position: relative;
  font-size: 1.1rem;
}

.cap-ticker #capAlertCrawl {
  display: inline-block;
  padding-left: 100%;
  animation: scroll-left 40s linear infinite;
}

/*Pause when hovered */
.cap-ticker:hover #capAlertCrawl {
  animation-play-state: paused;
}

@keyframes scroll-left {
  0%   { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}
</style>

  <section id="satellite">
    <h2>Live Satellite Feed (Infrared Band 13 - GOES-19)</h2>
    <p>Click below to view the real-time satellite animation for the Atlantic.</p>
    <a href="https://www.star.nesdis.noaa.gov/GOES/sector_band.php?sat=G16&sector=taw&band=13&length=24&refresh=true" target="_blank">
      <img src="https://cdn.star.nesdis.noaa.gov/GOES19/ABI/SECTOR/taw/13/1800x1080.jpg" alt="Satellite Preview" style="max-width:100%; border: 1px solid #ccc; border-radius: 8px;">
    </a>
  </section>

      <section id="forecast">
    <h2>Latest Forecasts & Warnings</h2>
    <h2>3-Day Weather Forecast</h2>
    <img src="assets/forecast-placeholder.png" alt="Forecast Graphic" style="max-width: 100%; height: auto; border: 1px solid #ccc;">
    <p><small>Updated forecast graphic will appear here</small></p>
    <p><a href="assets/forecast.pdf" download>📄 Download Full Weather Forecast (PDF)</a></p>

    <h2>Latest 3-Day Forecast Video</h2>
  <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; margin-top: 10px;">
    <iframe 
      src="https://www.youtube.com/embed/videoseries?list=PL0eQ794piI8As8cDF85mnbcNg45Y5P7lf" 
      style="position: absolute; top:0; left:0; width:100%; height:100%;" 
      frameborder="0" 
      allowfullscreen
      title="3-Day Forecast Playlist">
    </iframe>
  </div>
    
    <h2>🚨 Alerts & Warnings</h2>
    <div class="alert-links">
      <a href="https://cap-sources.s3.amazonaws.com/tc-gov-en/rss.xml" class="alert-card en" target="_blank" rel="noopener noreferrer" id="alert-en">
        <span class="flag">🇬🇧</span>
        <span class="label">TCI Emergency Alerts</span>
        <span class="lang">English</span>
        <p class="alert-summary">Loading latest alert...</p>
      </a>
      <a href="https://cap-sources.s3.amazonaws.com/tc-gov-es/rss.xml" class="alert-card es" target="_blank" rel="noopener noreferrer" id="alert-es">
        <span class="flag">🇪🇸</span>
        <span class="label">Alertas de Emergencia de TCI</span>
        <span class="lang">Español</span>
        <p class="alert-summary">Loading latest alert...</p>
      </a>
      <a href="https://cap-sources.s3.amazonaws.com/tc-gov-ht/rss.xml" class="alert-card ht" target="_blank" rel="noopener noreferrer" id="alert-ht">
        <span class="flag">🇭🇹</span>
        <span class="label">Alèt Ijans TCI</span>
        <span class="lang">Kreyòl Ayisyen</span>
        <p class="alert-summary">Loading latest alert...</p>
      </a>
    </div>

  </section>

 <section id="geocolor-forecast" style="display: flex; flex-wrap: wrap; align-items: flex-start; gap: 20px; margin-top: 40px;">
  <!-- GeoColor Image -->
  <div style="flex: 1; min-width: 300px; text-align: center;">
    <h2>GeoColor Caribbean Satellite</h2>
    <a href="https://www.star.nesdis.noaa.gov/GOES/sector_band.php?sat=G16&sector=car&band=GEOCOLOR&length=24" target="_blank">
      <img src="https://cdn.star.nesdis.noaa.gov/GOES19/ABI/SECTOR/car/GEOCOLOR/1000x1000.jpg" alt="GeoColor Caribbean" style="max-width: 100%; height: auto; border: 1px solid #ccc;">
    </a>
    <p><small>Click the image to view animation loop</small></p>
  </div>

  <!-- Forecast Graphic Placeholder -->
  <div style="flex: 1; min-width: 300px; text-align: center;">
    <h2>Surface Weather Chart</h2>
    <a href="https://www.nhc.noaa.gov/tafb_latest/USA_latest.gif" target="_blank">
      <img src="https://www.nhc.noaa.gov/tafb_latest/USA_latest.gif" alt="Surface Chart" style="max-width: 100%; height: auto; border: 1px solid #ccc;">
    </a>
    <p><small>Click the image for full size</small></p>
  </div>
</section> 


<footer class="footer" style="background: #0077b6; color: white; padding: 20px;">
  <p style="text-align: center; margin-bottom: 20px;">
    © 2025 Turks and Caicos Islands Airports Authority Meteorology Department
  </p>

  <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;">
    <!-- Social Media Section (Left) -->
    <div style="display: flex; align-items: center; gap: 10px;">
      <span style="font-weight: bold;">Follow Us on Social Media:</span>
      <a href="https://www.facebook.com" target="_blank" aria-label="Facebook">
        <img src="https://cdn-icons-png.flaticon.com/512/124/124010.png" alt="Facebook logo" style="height:32px; width:32px;">
      </a>
      <a href="https://www.twitter.com" target="_blank" aria-label="Twitter">
        <img src="https://cdn-icons-png.flaticon.com/512/733/733579.png" alt="Twitter logo" style="height:32px; width:32px;">
      </a>
      <a href="https://www.instagram.com" target="_blank" aria-label="Instagram">
        <img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram logo" style="height:32px; width:32px;">
      </a>
      <a href="https://www.youtube.com/@TCINationalWeatherService" target="_blank" aria-label="YouTube">
        <img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="YouTube logo" style="height:24px; width:24px;">
      </a>
      <a href="https://whatsapp.com/channel/0029VaIwxeqJZg4BmM48Cx2r" target="_blank" aria-label="WhatsApp">
        <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="WhatsApp logo" style="height:32px; width:32px;">
      </a>
    </div>

    <!-- Contact Info Right -->
    <div style="text-align: center;">
      <h3 style="margin: 0 0 5px 0;">Contact Us</h3>
      <p style="margin: 0;">
        Email: <a href="mailto:tci.metoffice@tciairports.tc" style="color: white; text-decoration: underline;">tci.metoffice@tciairports.tc</a><br>
        Phone: <a href="tel:+16499464420" style="color: white; text-decoration: underline;">+1 (649) 946-4420</a>
      </p>
    </div>
  </div>
</footer>

       <!-- 🚀 Script to Load Latest Alert from CAP RSS -->
  <script>
    async function loadCAPAlert() {
      const proxyUrl = "https://api.allorigins.win/get?url=";
      const feedUrl = encodeURIComponent("https://cap-sources.s3.amazonaws.com/tc-gov-en/rss.xml");
      const ticker = document.getElementById("capTicker");

     // try {
     //   const response = await fetch(`${proxyUrl}${feedUrl}`);
     //   const data = await response.json();
     //   const parser = new DOMParser();
     //   const xml = parser.parseFromString(data.contents, "application/xml");

        //const firstItem = xml.querySelector("item");
        //const title = firstItem.querySelector("title").textContent;
        //const description = firstItem.querySelector("description").textContent;
        //const link = firstItem.querySelector("link")?.textContent || "https://cap-sources.s3.amazonaws.com/tc-gov-en/rss.xml";

        //const alertHTML = `<a href="${link}" target="_blank" style="color: white; text-decoration: underline;">
        //  🚨 ${title}: ${description}
       // </a>`;

       // //const alertText = `🚨 ${title}: ${description}`;
       // document.getElementById("capAlertCrawl").innerHTML = alertHTML;
     // } catch (error) {
      //  document.getElementById("capAlertCrawl").textContent = "TCI EMERGENCY ALERTS NEWS FEED ⚠️ No new alerts at the moment.";
      //  console.error("Error fetching CAP feed:", error);
    //  }
  //  }

      try {
        const response = await fetch(feedUrl);
        const xmlText = await response.text();
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlText, "application/xml");

        const items = xmlDoc.querySelectorAll("item");
        const now = new Date();
        let alertHTML = "";

        items.forEach(item => {
          const title = item.querySelector("title")?.textContent;
          const description = firstItem.querySelector("description").textContent;
          const link = item.querySelector("link")?.textContent;

          const capExpires = item.querySelector("cap\\:expires, expires");
          const expiresText = capExpires?.textContent;
          const expiresDate = expiresText ? new Date(expiresText) : null;

          if (!expiresDate || expiresDate > now) {
            alertHTML += `<a href="${link}" target="_blank">${title}:${description}</a>`;
          }
        });

        document.getElementById("capAlertCrawl").innerHTML = `<span>${alertHTML || "TCI EMERGENCY ALERTS NEWS FEED ⚠️ No active alerts."}</span>`;
      } catch (error) {
        document.getElementById("capAlertCrawl").innerHTML = `<span>Unable to load alerts</span>`;
        console.error("CAP alert load error:", error);
      }
    }
    
    loadCAPAlert();
    </script>

    <script>
    async function fetchLatestAlert(cardId, feedUrl) {
      const proxyUrl = "https://api.allorigins.win/get?url=";
      try {
        const response = await fetch(proxyUrl + encodeURIComponent(feedUrl));
        const data = await response.json();

        const parser = new DOMParser();
        const xml = parser.parseFromString(data.contents, "application/xml");

    //const items = xml.getElementsByTagName("item");
    //const firstItem = items.length > 0 ? items[0] : null;

    //if (!firstItem) {
    //  document.querySelector(`#${cardId} .alert-summary`).textContent = "No active alerts.";
    //  document.getElementById(cardId).classList.remove("active");
    //  return;
    //}

    //const getTextFromTag = (parent, tag) => {
    //  const el = parent.getElementsByTagName(tag)[0];
    //  return el ? el.textContent : "";
    //};

   // const title = getTextFromTag(firstItem, "title");
   // const description = getTextFromTag(firstItem, "description");
   // const link = getTextFromTag(firstItem, "link");  

   // // Show the title + first 150 chars of description
   // const summary = `${title} - ${description.substring(0, 150)}${description.length > 150 ? "..." : ""}`;
   // const card = document.getElementById(cardId);

  //  card.querySelector(".alert-summary").textContent = summary;
  //  card.setAttribute("onclick", `window.open('${link}', '_blank')`);
  //  card.style.cursor = "pointer";
    
  //  card.classList.add("active");
  //} catch (error) {
  //  console.error(`Error loading alerts for ${cardId}`, error);
  //  document.querySelector(`#${cardId} .alert-summary`).textContent = "Failed to load alerts.";
 // }
//}

    //Updated so that the alert cards only show active alerts
      const items = xml.getElementsByTagName("item");
      let activeAlert = null;

      for (let i = 0; i < items.length; i++) {
        const item = items[i];
        const expiresTag = Array.from(item.getElementsByTagName("*")).find(tag => tag.localName === "expires");
        const expiresText = expiresTag ? expiresTag.textContent : "";

        if (!expiresText) continue;

        const expires = Date.parse(expiresText);
        if (isNaN(expires)) continue;

        const now = Date.now();
        if (expires > now) {
          activeAlert = item;
          break;
        }
      }

      const card = document.getElementById(cardId);

      if (!activeAlert) {
        card.querySelector(".alert-summary").textContent = "No active alerts.";
        card.classList.remove("active");
        card.style.cursor = "default";
        card.removeAttribute("onclick");
        return;
      }

      const getTextFromTag = (parent, tag) => {
        const el = parent.getElementsByTagName(tag)[0];
        return el ? el.textContent : "";
      };

      const title = getTextFromTag(activeAlert, "title");
      const description = getTextFromTag(activeAlert, "description") || "";
      const link = getTextFromTag(activeAlert, "link");

      const summary = `${title} - ${description.substring(0, 150)}${description.length > 150 ? "..." : ""}`;

      card.querySelector(".alert-summary").textContent = summary;
      card.setAttribute("onclick", `window.open('${link}', '_blank')`);
      card.style.cursor = "pointer";
      card.classList.add("active");
    } catch (error) {
      console.error(`Error loading alerts for ${cardId}`, error);
      const card = document.getElementById(cardId);
      card.querySelector(".alert-summary").textContent = "Failed to load alerts.";
      card.classList.remove("active");
      card.style.cursor = "default";
      card.removeAttribute("onclick");
    }
  }
    

fetchLatestAlert("alert-en", "https://cap-sources.s3.amazonaws.com/tc-gov-en/rss.xml");
fetchLatestAlert("alert-es", "https://cap-sources.s3.amazonaws.com/tc-gov-es/rss.xml");
fetchLatestAlert("alert-ht", "https://cap-sources.s3.amazonaws.com/tc-gov-ht/rss.xml");

  </script>


</body>
</html>
